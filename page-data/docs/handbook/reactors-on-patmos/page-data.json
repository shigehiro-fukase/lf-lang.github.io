{
    "componentChunkName": "component---src-templates-documentation-tsx",
    "path": "/docs/handbook/reactors-on-patmos",
    "result": {"data":{"markdownRemark":{"id":"81203943-ac81-5af9-a62b-1521d7e08b1d","excerpt":"Reactors on Patmos Reactors can be executed on Patmos, a bare-metal execution platform\nthat is optimized for time-predictable execution. Well written C programs…","html":"<h2 id=\"reactors-on-patmos\" style=\"position:relative;\"><a href=\"#reactors-on-patmos\" aria-label=\"reactors on patmos permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reactors on Patmos</h2>\n<p>Reactors can be executed on <a href=\"https://github.com/t-crest/patmos\">Patmos</a>, a bare-metal execution platform\nthat is optimized for time-predictable execution. Well written C programs can be analyzed for their\nworst-case execution time (WCET).</p>\n<h3 id=\"compiling-and-running-reactors\" style=\"position:relative;\"><a href=\"#compiling-and-running-reactors\" aria-label=\"compiling and running reactors permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Compiling and Running Reactors</h3>\n<p>Patmos can run in an FPGA, but there are also two\nsimulators available:</p>\n<ol>\n<li><code class=\"language-text\">pasim</code> a software ISA simulator that is written in C++.</li>\n<li><code class=\"language-text\">patemu</code> a cycle-accurate hardware emulator generated from the hardware description.</li>\n</ol>\n<p>To execute reactions on Patmos, the <a href=\"https://github.com/t-crest/patmos\">Patmos toolchain</a> needs\nto be installed. The web page contains a quick start, detailed information including how to\nperform WCET analysis is available in the\n<a href=\"http://patmos.compute.dtu.dk/patmos_handbook.pdf\">Patmos Reference Handbook</a>.</p>\n<p>To execute the “hello world” reactor on Patmos use the LF compiler to generate the C code.\nCompile the reactor with the Patmos compiler (in <code class=\"language-text\">src-gen</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">patmos-clang Minimal.c -o Minimal.elf</code></pre></div>\n<p>The reactor can be executed on the SW simulator with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">pasim Minimal.elf</code></pre></div>\n<p>As Patmos is a bare metal runtime that has no notion of calendar time, its start time\nis considered the epoch and the following output will be observed:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Start execution at time Thu Jan  1 00:00:00 1970\nplus 640000 nanoseconds.\nHello World.\nElapsed logical time (in nsec): 0\nElapsed physical time (in nsec): 3970000</code></pre></div>\n<p>The reactor can also be executed on the hardware emulator of Patmos:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">patemu Minimal.elf</code></pre></div>\n<p>This execution is considerably slower than the SW simulator, as the concrete hardware\nof Patmos is simulated cycle-accurate.</p>\n<h3 id=\"worst-case-execution-time-analysis\" style=\"position:relative;\"><a href=\"#worst-case-execution-time-analysis\" aria-label=\"worst case execution time analysis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Worst-Case Execution Time Analysis</h3>\n<p>Following example is a code fragment from\n<a href=\"https://github.com/lf-lang/lingua-franca/blob/master/xtext/org.icyphy.linguafranca/src/test/C/src/Wcet.lf\">Wcet.lf</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"lf-c\"><pre class=\"language-lf-c\"><code class=\"language-lf-c\"><span class=\"token lf_keywords\">reactor</span> Work <span class=\"token punctuation\">{</span>\n    <span class=\"token lf_keywords\">input</span> in1<span class=\"token operator\">:</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">;</span>\n    <span class=\"token lf_keywords\">input</span> in2<span class=\"token operator\">:</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">;</span>\n    <span class=\"token lf_keywords\">output</span> out<span class=\"token operator\">:</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">;</span>\n    <span class=\"token lf_keywords\">reaction</span><span class=\"token punctuation\">(</span>in1<span class=\"token punctuation\">,</span> in2<span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> out <span class=\"token punctuation\">{</span><span class=\"token operator\">=</span>\n    \t<span class=\"token keyword\">int</span> ret<span class=\"token punctuation\">;</span>\n    \t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>in1 <span class=\"token operator\">></span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t\tret <span class=\"token operator\">=</span> in2 <span class=\"token operator\">*</span> in1<span class=\"token punctuation\">;</span>\n    \t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    \t\tret <span class=\"token operator\">=</span> in2 <span class=\"token operator\">+</span> in1<span class=\"token punctuation\">;</span>\n    \t<span class=\"token punctuation\">}</span>\n        <span class=\"token function\">SET</span><span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">,</span> ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">=</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We want to perform WCET analysis of the single reaction of the Work reactor.\nThis reaction, depending on the input data, will either perform a multiplication,\nwhich is more expensive in Patmos, or an addition. The WCET analysis shall consider\nthe multiplication path as the worst-case path. To generate the information for\nWCET analysis by the compiler we have to compile the application as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">patmos-clang -O2 -mserialize=wcet.pml Wcet.c</code></pre></div>\n<p>We investigate the C source code <code class=\"language-text\">Wcet.c</code> and find that the reaction we\nare interested is named <code class=\"language-text\">reaction_function1</code>. Therefore, we invoke WCET analysis\nas follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">platin wcet -i wcet.pml -b a.out -e reaction_function1 --report</code></pre></div>\n<p>This results in following report:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">...\n[platin] INFO: Finished run WCET analysis (platin)          in 62 ms\n[platin] INFO: best WCET bound: 242 cycles\n---\n- analysis-entry: reaction_function1\n  source: platin\n  cycles: 242\n...</code></pre></div>\n<p>The analysis gives the WCET of 242 clock cycles for the reaction,\nwhich includes clock cycles for data cache misses.\nFurther details on the WCET analysis\ntool <code class=\"language-text\">platin</code> and e.g., how to annotate loop bounds can be found in the\n<a href=\"http://patmos.compute.dtu.dk/patmos_handbook.pdf\">Patmos Reference Handbook</a>.</p>\n<p>Note, that the WCET analysis of a reaction does only include the code of the\nreaction function, not the cache miss cost of calling the function from\nthe scheduler or the cache miss cost when returning to the scheduler.</p>","headings":[{"value":"Reactors on Patmos","depth":2},{"value":"Compiling and Running Reactors","depth":3},{"value":"Worst-Case Execution Time Analysis","depth":3}],"frontmatter":{"permalink":"/docs/handbook/reactors-on-patmos","title":"Reactors on Patmos","oneline":"Reactors on Patmos (preliminary)","preamble":""}},"prev":{"childMarkdownRemark":{"frontmatter":{"title":"Contributing","oneline":"Contribute to Lingua Franca.","permalink":"/docs/handbook/contributing"}}},"next":{"childMarkdownRemark":{"frontmatter":{"title":"Contributing","oneline":"Contribute to Lingua Franca.","permalink":"/docs/handbook/contributing"}}}},"pageContext":{"id":"5-reactors-on-patmos","slug":"/docs/handbook/reactors-on-patmos","repoPath":"/packages/documentation/copy/en/preliminary/Reactors on Patmos.md","lang":"en","modifiedTime":"2022-04-28T16:35:36.677Z"}},
    "staticQueryHashes": []}